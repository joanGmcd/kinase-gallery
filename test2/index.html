<!DOCTYPE html>
<html>
<head>
    <title>3D Protein Structure</title>
</head>
<body>
<script type="module">
  import * as THREE from '../three.module.js';
  import { VRMLLoader } from '../VRMLLoader.js';
  import { OrbitControls } from '../OrbitControls.js';
// Create a raycaster
var raycaster = new THREE.Raycaster();
var mouse = new THREE.Vector2();

// Add a mouse move event listener
window.addEventListener('mousemove', onMouseMove, false);

// Define a plane or object to intersect with (e.g., the ground plane)
var plane = new THREE.Plane(new THREE.Vector3(0, 1, 0), 0);

// Function to handle mouse move event
function onMouseMove(event) {
    // Normalize mouse position to (-1, 1) range
    mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
    mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

    // Update the raycaster with the camera and mouse position
    raycaster.setFromCamera(mouse, camera);

    // Calculate the intersection of the ray with the plane
    var intersects = raycaster.ray.intersectPlane(plane);

    if (intersects) {
        // Display the coordinates
        var coords = `X: ${intersects.x.toFixed(2)}, Y: ${intersects.y.toFixed(2)}, Z: ${intersects.z.toFixed(2)}`;
        console.log(coords); // Or display in an HTML element
    }
}
  // Create a scene, camera, and renderer
  var scene = new THREE.Scene();
  var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
  var renderer = new THREE.WebGLRenderer();
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);
  // Ambient Light
  var ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
  scene.add(ambientLight);

  // Directional Light
  var light = new THREE.DirectionalLight(0xffffff, 1);
  light.position.set(10, 10, 10);
  scene.add(light);

  // Point Light attached to the camera
  var pointLight = new THREE.PointLight(0xffffff, 0.5);
  camera.add(pointLight);
  scene.add(camera);

  // Create a loader
  var loader = new VRMLLoader();

  // Load the protein structure
  loader.load('overview.wrl', function (object) {
    // Add the loaded object to the scene
    scene.add(object);
  });
  // Create a canvas and draw text onto it
  var canvas = document.createElement('canvas');
  var context = canvas.getContext('2d');
  context.font = '24px Arial';
  context.fillStyle = 'red';
  context.textAlign = 'center';
  context.fillText('DFG', canvas.width / 2, canvas.height / 2);

// Create a texture from the canvas
  var texture = new THREE.Texture(canvas); 
  texture.needsUpdate = true;

// Create a material using the texture
  var material = new THREE.SpriteMaterial({ map: texture });

// Create a sprite using the material
  var sprite = new THREE.Sprite(material);

// Set the position of the sprite
  sprite.position.set(17.664833,13.5631695,7.0937195); // Adjust as needed

// Add the sprite to the scene
  scene.add(sprite);

// In your animation loop, update the sprite's rotation to match the camera's rotation
  var animate = function () {
  requestAnimationFrame(animate);

  // Make the sprite face the camera
  sprite.quaternion.copy(camera.quaternion);

  renderer.render(scene, camera);
  };
  // Position the camera
  camera.position.z = 5;

  // Create OrbitControls
  var controls = new OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true; // Enable smooth damping
  controls.dampingFactor = 0.05;

  // Define an animation loop
  var animate = function () {
    requestAnimationFrame(animate);
    controls.update(); // Update the controls
    renderer.render(scene, camera);
  };

  // Start the animation loop
  animate();
</script>
</body>
</html>
